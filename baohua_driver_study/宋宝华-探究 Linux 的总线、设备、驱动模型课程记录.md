# 宋宝华-探究 Linux 的总线、设备、驱动模型课程记录

**宋老师**：这个课程有一个群，就是有一个二维码，然后有八十几个同学好像已经在这个群里面了，另外，因为我们报名的同学有 300 多个嘛，可能还有很多同学不在里面，有些同学了，他可能报了名，可能因为时间或天气的原因，他没有加进来，但是只要报过名的，任何时间都可以上来看这个录播。

**宋老师**：然后我们的时间大概就是从 8 点到 9 点，我这个一个小时主要给大家把 linux 里面的那个设备驱动模型，让大家彻底的把它理解清楚，就是 linux 为什么要把设备驱动模型设计成这个样子，还有在非常复杂的产品之下，比如说我有一块电路板，非常复杂，然后上面各种各样的总线，总线上面又级联总线。究竟这样的模型在 linux 里面是怎么实现的，然后呢，我会用一些图形的方式给大家展现出来，最主要的呢，知其然并且知其所以然，我会把背后的原因给大家说明。最后呢，我还会给大家讲一下比如说现在基于 devicetree 之后，那么这个设备驱动模型是不是变了呢？它肯定很有可能没有变，是吧？我会讲所有的这样一些故事，通过今天这一个小时的学习呢，大家基本上可以把教科书上看的有些东西，比如说 LDD3 啊或者有些东西，你会觉得看起来好像很悬，但是你不知道它为什么会这么去做，究竟跟现实生活中的一些代码怎么样去结合，我们最主要是让大家把它结合起来。所有的同学都可以扫描这个二维码，加进关于这个课程的问题的一些讨论或者什么之类的。

**宋老师**：好，前面一部分知识快速的给大家带过去，就是 linux 为什么把设备驱动分成“总线-设备-驱动”模型，其实说白了，一切都是为了软件架构里面的“高内聚、低耦合”，其实 linux 特别强调一个概念，哪一个概念呢？就是它的驱动是天然跨平台的，其实在 linux 里面其实不太倡导一个概念，叫“驱动移植”，其实没有这样一个概念，其实驱动写出来，比如我一个触摸屏，我一个以太网，不管这个以太网或这个触摸屏接在 TI、三星、高通、飞思卡尔等等不同的硬件电路板上或不同的 SOC 上，其实它本身的工作逻辑都没有变，所以 linux 特别强调一个概念，就是我写好一份驱动之后，它应该可以适配到任何一个电路板上，而在这个里面不要去改驱动本身的代码，因为驱动本身的工作它是让这个驱动“同样一份的驱动代码，可以在全世界不同的各种各样的使用这一个设备的电路板上工作起来”，所以这是我们要建立的第一点认识。那么为什么我们以前写出来的很多驱动代码它没有办法在不同的平台上移植?很大程度上是我们犯了这样的错误，

